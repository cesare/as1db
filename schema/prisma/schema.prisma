// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Class {
  id Int @id @default(autoincrement())
  name String @unique

  items Item[]

  @@map("classes")
}

model Category {
  id Int @id @default(autoincrement())
  name String @unique

  items ItemCategory[]

  @@map("categories")
}

model Effect {
  id Int @id @default(autoincrement())
  name String @unique

  items ItemEffects[]

  @@map("effects")
}

model Trait {
  id Int @id @default(autoincrement())
  name String @unique

  items ItemTraits[]

  composition TraitComposition? @relation(name: "composition")
  lhs TraitComposition[] @relation(name: "lhs")
  rhs TraitComposition[] @relation(name: "rhs")

  @@map("traits")
}

model Item {
  id Int @id @default(autoincrement())
  classId Int @map("class_id")
  class Class @relation(fields: [classId], references: [id])
  name String @unique

  categories ItemCategory[]
  effects ItemEffects[]
  traits ItemTraits[]

  @@map("items")
}

model ItemCategory {
  itemId Int @map("item_id")
  item Item @relation(fields: [itemId], references: [id])

  categoryId Int @map("category_id")
  category Category @relation(fields: [categoryId], references: [id])

  @@map("item_categories")
  @@id([itemId, categoryId])
}

model ItemEffects {
  itemId Int @map("item_id")
  item Item @relation(fields: [itemId], references: [id])

  effectId Int @map("effect_id")
  effect Effect @relation(fields: [effectId], references: [id])

  @@map("item_effects")
  @@id([itemId, effectId])
}

model ItemTraits {
  itemId Int @map("item_id")
  item Item @relation(fields: [itemId], references: [id])

  traitId Int @map("trait_id")
  trait Trait @relation(fields: [traitId], references: [id])

  @@map("item_traits")
  @@id([itemId, traitId])
}

model TraitComposition {
  traitId Int @id @map("trait_id")
  trait Trait @relation(name: "composition", fields: [traitId], references: [id])

  lhsId Int @map("lhs_id")
  lhs Trait @relation(name: "lhs", fields: [lhsId], references: [id])

  rhsId Int @map("rhs_id")
  rhs Trait @relation(name: "rhs", fields: [rhsId], references: [id])

  @@map("trait_compositions")
  @@unique([lhsId, rhsId])
}
